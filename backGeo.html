<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Teste</title>

<link rel="stylesheet" href="css/jquery.mobile-1.4.1.min.css">
<link rel="stylesheet" href="css/jquery.mobile.structure-1.4.1.min.css">
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="css/jqm-demos.css">  
<link rel="stylesheet" href="css/index.css" />
<link rel="stylesheet" href="css/prettify.css">

<link rel="shortcut icon" href="icon.png">

<script type="text/javascript" src="phonegap.js"></script>

<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="js/jquery.mobile-1.4.1.min.js"></script>



<script type="text/javascript">
        $(document).bind("mobileinit", function () {
		    $.mobile.buttonMarkup.hoverDelay = true;
		    $.mobile.touchOverflowEnabled = true;
		    $.mobile.phonegapNavigationEnabled = true;
		    $.mobile.pushStateEnabled = false;
		    $.mobile.ajaxEnabled = false;
		});
		$(document).bind('pageinit', function () {

		});
		$(document).ready(function () {
		var bgGeo = null;
		
            function parar() {
				if (watchID != null) {
					navigator.geolocation.clearWatch(watchID);
					watchID = null;
				}
			};
		
			var app = {
				// Construtor Aplicação
				initialize: function() {
					this.bindEvents();
				},
				// Bind Event Listeners
				//
				// Vincular eventos que são necessários na inicialização. Eventos comuns são:
				// 'load', 'deviceready', 'offline', and 'online'.
				bindEvents: function() {
					document.addEventListener('deviceready', this.onDeviceReady, false);
				},
				// deviceready Event Handler
				//
				// The scope of 'this' is the event. In order to call the 'receivedEvent' function, we must explicity call 'app.receivedEvent(...);'
				// O escopo de "isto" é o evento. Para chamar a função 'receivedEvent', devemos explicitamente chamar 'app.receivedEvent (...);'
				onDeviceReady: function() {
					app.receivedEvent('deviceready');

					if (window.plugins.backgroundGeoLocation) {
						app.configureBackgroundGeoLocation();
					}

				},
				// Update DOM em um evento recebeu
				receivedEvent: function(id) {
					var parentElement = document.getElementById(id);
					var listeningElement = parentElement.querySelector('.listening');
					var receivedElement = parentElement.querySelector('.received');

					listeningElement.setAttribute('style', 'display:none;');
					receivedElement.setAttribute('style', 'display:block;');

					console.log('Received Event: ' + id);
				},
				configureBackgroundGeoLocation: function() {
					// Seu aplicativo deve executar pelo menos uma chamada para a posição atual via geolocalização Cordova padrão,
					// a fim de solicitar ao usuário Localização permissão.
					window.navigator.geolocation.getCurrentPosition(function(location) {
						console.log('Location from Phonegap');
					});

					bgGeo = window.plugins.backgroundGeoLocation;

					/**
					* Este seria o seu próprio retorno de chamada para AJAX pedidos depois de postar fundo de geolocalização ao seu servidor.
					*/
					var yourAjaxCallback = function(response) {
						////
						// IMPORTANT:  You must execute the #finish method here to inform the native plugin that you're finished,
						//  and the background-task may be completed.  You must do this regardless if your HTTP request is successful or not.
						// IF YOU DON'T, ios will CRASH YOUR APP for spending too much time in the background.
						
						// IMPORTANTE: Você deve executar o método #finish aqui para informar o plugin nativo que você está acabado,
						// eo fundo-tarefa pode ser concluída. Você deve fazer isso independentemente se o seu pedido HTTP é bem sucedido ou não.
						// Se não o fizer, ios irá travar o seu APP para passar muito tempo em segundo plano.
						//
						bgGeo.finish();
					};

					/**
					* Este callback será executado toda vez que um de geolocalização é gravado em segundo plano.
					*/
					var callbackFn = function(location) {
						console.log('[js] BackgroundGeoLocation callback:  ' + location.latitudue + ',' + location.longitude);
						// Faça o seu pedido HTTP aqui para postar localização para o servidor.
						yourAjaxCallback.call(this);
					};

					var failureFn = function(error) {
						console.log('BackgroundGeoLocation error');
					};
					
					// BackgroundGeoLocation is highly configurable.
					bgGeo.configure(callbackFn, failureFn, {
						desiredAccuracy: 10,
						stationaryRadius: 20,
						distanceFilter: 30,
						debug: true // <-- ativar esse ouvir sons para o ciclo de vida de fundo-de geolocalização.
					});

					// Ligue o sistema de fundo-de geolocalização. O usuário será monitorado sempre que suspender a aplicação.
					bgGeo.start();

					// If you wish to turn OFF background-tracking, call the #stop method.
					// bgGeo.stop()
				};
			};
			
			function parar() {
			    alert(bgGeo);
				alert('Parou!!!');
			    bgGeo.stop();
			}
		});
    </script>
</head>

<body>

	<!-- Start of first page: #one -->
	<div data-role="page" id="pageButtonsLogin" data-theme="a">

		<div role="main" class="ui-content">
			<h1>PhoneGap</h1>
            <div id="deviceready" class="blink">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
				<br/>
				<br/>
				<button onclick="parar();">Parar</button>
            </div>
		</div>
		<!-- /content -->

	</div>
	<!-- /page one -->



</body>
</html>

